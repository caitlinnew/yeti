openapi: 3.0.0
x-stoplight:
  id: ek53he4lr3bch
tags:
  - name: Pet Insurance
    description: API related to Pet Insurance
  - name: Experience API
    description: Experience APIs in CTM
info:
  title: Pet Partner Sales API
  version: 1.0.1
  description: Public API for Notification of Partner Sales and Cancellation Events.  This API provides a way to receive sales-related information from our Pet Partners
security:
  - BearerAuth: []
paths:
  '/quotes/{quoteReference}/partnerQuotes/{partnerQuoteReference}':
    post:
      summary: Customer Handover
      description: Used by Partners to notify CTM of the Customer Handover Acknowldgement
      operationId: notifyHandover
      parameters:
        - name: quoteReference
          schema:
            $ref: '#/components/schemas/QuoteReference'
          in: path
          required: true
        - name: partnerQuoteReference
          schema:
            $ref: '#/components/schemas/PartnerQuoteReference'
          in: path
          required: true
      responses:
        '202':
          description: Handover confirmed
  '/sales/{saleId}/policies/{policyNumber}':
    put:
      summary: Partner Sales
      description: End point for Creation of a Partner Sale used by Partners to notify CTM of Partner Sales from a CTM referral
      operationId: createPartnerSales
      parameters:
        - name: saleId
          description: Sale Transaction Id or Invoice Id generated by the Partner’s Systems
          in: path
          required: true
          schema:
            type: string
        - name: policyNumber
          description: Insurer's Identifier of the Policy
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PetPartnerSale'
        description: Post the necessary fields for the API to create a new user.
      responses:
        '202':
          description: Partner Sales Accepted
        '400':
          description: Missing Required Information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Errors'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Errors'
    delete:
      summary: Partner Sales
      operationId: deletePartnerSales
      description: End-point for Delete of a Partner Sale used by Partners to notify CTM of Customers that have decided to cancel the sale that originated from CTM referral
      parameters:
        - name: saleId
          description: Sale Transaction Id or Invoice Id generated by the Partner’s Systems
          in: path
          required: true
          schema:
            type: string
        - name: policyNumber
          description: Insurer's Identifier of the Policy
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '400':
          description: Missing Required Information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Errors'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Errors'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SalesCancellation'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Errors:
      title: Errors
      x-stoplight:
        id: wv65t9myahiv3
      type: array
      items:
        $ref: '#/components/schemas/ErrorMessage'
    QuoteReference:
      x-stoplight:
        id: ojxisomppxslp
      title: Quote Reference
      type: string
      description: Quote Reference generated by CTM for a Customer User Journey
      example: Q-CTM-PET-00012
    PartnerQuoteReference:
      x-stoplight:
        id: ad9h3lla10n2f
      title: Partner Quote Reference
      type: string
      description: Partner Quote Reference number generated by the CTM Partners as part of the Journey
      example: PQ-01231AS
    PartnerSales:
      title: Partner Sales
      x-stoplight:
        id: dqy525a8pt94n
      type: object
      description: Schema definition of Partner Sales used by Partner APIs to notify CTM of a Sale
      x-tags:
        - Common
      properties:
        saleId:
          type: string
          description: Sale Transaction Id or Invoice Id generated by the Partner’s Systems
          example: BTI-5432
        partnerQuoteReference:
          $ref: '#/components/schemas/PartnerQuoteReference_2'
        quoteReference:
          $ref: '#/components/schemas/QuoteReference_2'
        brand:
          type: string
          description: Brand
          example: Coles
        channel:
          enum:
            - Online
            - Call-Centre
            - Direct
          description: The channel through which the policy was sold
        comparisonBrand:
          $ref: '#/components/schemas/ComparisonBrand'
        policyHolder:
          type: object
          $ref: '#/components/schemas/PolicyHolder'
        policyNumber:
          type: string
          description: Insurer's Identifier of the Policy
          example: CPI45654
        policyRiskNumber:
          enum:
            - 1
            - 2
            - 3
            - 4
            - 5
            - 6
            - 7
            - 8
            - 9
          description: Indicates the sequence of assets insured under the Policy (if applicable)
        productCode:
          description: |-
            The unique Product ID used by the provider to identify the product in question. Used by CTM  for sales reporting and reconciliation
            It is essential that every product offered by the provider have a unique product identifier associated with it.
          type: string
          example: PRD1231
        productName:
          description: 'The name of the product, as displayed on the Results page and Product Details page.'
          type: string
          example: Premium Insurance
        soldDate:
          $ref: '#/components/schemas/DateTimeString'
          description: 'Date of the Policy was sold offset relative to UTC as per [RFC3339](https://datatracker.ietf.org/doc/html/rfc3339)'
        commencementDate:
          $ref: '#/components/schemas/DateTimeString'
          description: 'Date Cover of the Policy will start, offset relative to UTC as per [RFC3339](https://datatracker.ietf.org/doc/html/rfc3339)'
        premium:
          type: number
          description: The total annual value of the Policy sold i.e. Gross Written Premium excluding GST (GWP)
          format: double
          example: 51.75
      required:
        - saleId
        - partnerQuoteReference
        - quoteReference
        - brand
        - channel
        - comparisonBrand
        - policyHolder
        - policyNumber
        - soldDate
        - commencementDate
    PolicyHolder:
      type: object
      title: Policy Holder
      x-stoplight:
        id: rmkprgalm7cis
      x-tags:
        - Common
      description: Details of the Policy Holder
      required:
        - firstName
        - lastName
        - emailAddress
      properties:
        firstName:
          type: string
          description: The first name of the primary Policy holder
          example: Luke
        lastName:
          type: string
          description: The surname of the primary Policy holder
          example: Skywalker
        dateOfBirth:
          $ref: '#/components/schemas/DateString'
          description: The date of birth of the primary Policy holder
        emailAddress:
          type: string
          description: The email address of the primary Policy holder
          example: luke.skywalker@jedicouncil.org
    SalesCancellation:
      title: Sales Cancellation
      x-stoplight:
        id: thmfh82zjbxpq
      x-tags:
        - Common
      type: object
      description: Object defining the Partner Sales Cancellation
      properties:
        quoteReference:
          $ref: '#/components/schemas/QuoteReference_2'
        partnerQuoteReference:
          $ref: '#/components/schemas/PartnerQuoteReference_2'
        cancellationDate:
          $ref: '#/components/schemas/DateString'
          description: Date that the Policy was cancelled
        cancellationEffectiveDate:
          $ref: '#/components/schemas/DateString'
          description: Date that the policy cancellation takes effect from.
        commencementDate:
          $ref: '#/components/schemas/DateString'
          description: Date when the Cover had started
        comparisonBrand:
          $ref: '#/components/schemas/ComparisonBrand'
        policyNumber:
          type: string
          description: Insurer's Identifier of the Policy
          example: BDG543123
        policyRiskNumber:
          enum:
            - 1
            - 2
            - 3
            - 4
            - 5
            - 6
            - 7
            - 8
            - 9
          description: Indicates the sequence of assets insured under the Policy (if applicable)
        emailAddress:
          type: string
          description: The email address of the primary Policy holder
          example: luke.skywalker@jedicouncil.org
        cancellationReason:
          type: string
          description: Reason the policy was cancelled
          example: Customer Found Cheaper Alternative
        brand:
          type: string
          description: Brand
          example: Budget
      required:
        - quoteReference
        - partnerQuoteReference
        - cancellationDate
        - commencementDate
        - comparisonBrand
        - policyNumber
        - policyRiskNumber
        - brand
    SimpleAddress:
      description: The Residential Address of the Pet
      title: Simple Address
      x-stoplight:
        id: isttsrojc4jvt
      x-tags:
        - Common
      type: object
      properties:
        mailingName:
          type: string
          description: Name of the individual or business formatted for inclusion in an address
        addressLine1:
          type: string
          description: First line of the standard address object
          example: 80 Jephson Street
        addressLine2:
          type: string
          description: Second line of the standard address object
        addressLine3:
          type: string
          description: Third line of the standard address object
        postcode:
          $ref: '#/components/schemas/Postcode'
        city:
          type: string
          description: Name of the city or locality
          example: Toowong
        state:
          type: string
          description: 'Free text if the country is not Australia. If country is Australia then must be one of the values defined by the State Type Abbreviation in the PAF file format. NSW, QLD, VIC, NT, WA, SA, TAS, ACT, AAT'
        country:
          $ref: '#/components/schemas/CountryCode'
          default: AUS
      required:
        - addressLine1
        - postcode
        - city
        - state
    DateString:
      description: Date that the Policy was cancelled
      title: DateString
      x-stoplight:
        id: siub7d7i73l5r
      x-tags:
        - Data Types
      type: string
      pattern: '([12]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01]))'
      format: date
      example: '2012-12-25'
    DateTimeString:
      description: 'Date of the Policy was sold offset relative to UTC as per [RFC3339](https://datatracker.ietf.org/doc/html/rfc3339)'
      title: DateTimeString
      x-stoplight:
        id: 0i0fk25gs8wey
      x-tags:
        - Data Types
      type: string
      pattern: '\d{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2]\d|3[0-1])T(?:[0-1]\d|2[0-3]):[0-5]\d:[0-5]\d(?:\.\d+|)(?:Z|(?:\+|\-)(?:\d{2}):?(?:\d{2}))'
      format: date-time
      example: '2007-05-01T15:43:00.12345Z'
    PositiveInteger:
      description: The total annual value of the policy sold before stamp and GST
      title: PositiveInteger
      x-stoplight:
        id: wwjuiak8n79we
      x-tags:
        - Data Types
      type: number
      format: double
      minimum: 1
      example: 12.32
    RateString:
      description: Partner's Agreed Commission Rate
      title: RateString
      x-stoplight:
        id: m5lbgekeaqjaj
      x-tags:
        - Data Types
      type: string
      pattern: '^[-]{0,1}[0]{0,1}0[1-9]{0,15}\.[0-9]{0,16}'
      example: '0.05'
    PetPartnerSale:
      title: Pet Partner Sales
      x-stoplight:
        id: 0w53lzmsvten1
      type: object
      description: Schema definition of Partner Sales in Pet Verticals used by Partners to notify CTM of a Sale or Cancellation
      x-tags:
        - Domain - Pet
      properties:
        salesDetails:
          $ref: '#/components/schemas/PartnerSales'
        policyDetails:
          $ref: '#/components/schemas/PetPolicy'
      required:
        - salesDetails
        - policyDetails
    PetPolicy:
      title: Pet Policy
      x-stoplight:
        id: 80q6ctjcqtc2c
      x-tags:
        - Domain - Pet
      type: object
      description: Schema definition of Policy Details for Pet Insurance
      properties:
        coverType:
          $ref: '#/components/schemas/CoverType'
          description: Level of cover of product
        petResidentialAddress:
          $ref: '#/components/schemas/SimpleAddress'
          description: The Residential Address of the Pet
        commissionType:
          description: Type of Commission which is a fixed Percentage
          enum:
            - FIXED
            - PERCENTAGE
        commissionRate:
          $ref: '#/components/schemas/RateString'
          description: Partner's Agreed Commission Rate
        commissionAmount:
          $ref: '#/components/schemas/PositiveInteger'
          description: 'Calculated commission of policy sold using the commission rate and type, eg 20% X 808.65 for a percentage commission type'
        netPremium:
          $ref: '#/components/schemas/PositiveInteger'
          description: The total annual value of the policy sold before stamp and GST
        renewal:
          type: boolean
          description: Indicator if the policy is being renewed
          example: true
        renewalCounter:
          type: integer
          description: Field for tracking the number of times the Policy is renewed from an initial sale
          minimum: 1
          maximum: 7
          example: 3
        directIndicator:
          type: boolean
          description: Indicator for tha direct sale of the Pet Policy
          example: true
      required:
        - coverType
        - petResidentialAddress
        - commissionType
        - commissionRate
        - commissionAmount
        - netPremium
        - renewal
        - renewalCounter
        - directIndicator
    ErrorMessage:
      title: Error Message
      x-stoplight:
        id: 6naa5yr1romea
      type: object
      description: Error Message Schema
      properties:
        code:
          type: string
          description: A unique code such as traceId used by the API developer to identify an error. Should not match HTTP response status code.
          example: 00-a1f462798df88af9a8462fb644af3be7-a8d45e87a76d025a-00
        title:
          type: string
          description: Title of the Error
          example: One or more validation errors occurred
        detail:
          type: string
          description: Brief Description of the Error
          example: The SourceName field is required
    ComparisonBrand:
      title: Comparison Brand
      x-stoplight:
        id: jqxua6brokb0w
      x-tags:
        - Field
      type: string
      description: Comparison Platform Code on which the Customer Journey occured
      enum:
        - CTM
        - CHOOSI
        - CC
    CountryCode:
      default: AUS
      title: Country Code
      x-stoplight:
        id: 2ytu4cuxvaoft
      x-tags:
        - Field
      type: string
      description: 'A valid [ISO 3166 Alpha-3](https://www.iso.org/iso-3166-country-codes.html) country code. Australia (AUS) is assumed if country is not present.'
      enum:
        - AFG
        - ALA
        - ALB
        - DZA
        - ASM
        - AND
        - AGO
        - AIA
        - ATA
        - ATG
        - ARG
        - ARM
        - ABW
        - AUS
        - AUT
        - AZE
        - BHS
        - BHR
        - BGD
        - BRB
        - BLR
        - BEL
        - BLZ
        - BEN
        - BMU
        - BTN
        - BOL
        - BES
        - BIH
        - BWA
        - BVT
        - BRA
        - IOT
        - BRN
        - BGR
        - BFA
        - BDI
        - CPV
        - KHM
        - CMR
        - CAN
        - CYM
        - CAF
        - TCD
        - CHL
        - CHN
        - CXR
        - CCK
        - COL
        - COM
        - COG
        - COD
        - COK
        - CRI
        - CIV
        - HRV
        - CUB
        - CUW
        - CYP
        - CZE
        - DNK
        - DJI
        - DMA
        - DOM
        - ECU
        - EGY
        - SLV
        - GNQ
        - ERI
        - EST
        - SWZ
        - ETH
        - FLK
        - FRO
        - FJI
        - FIN
        - FRA
        - GUF
        - PYF
        - ATF
        - GAB
        - GMB
        - GEO
        - DEU
        - GHA
        - GIB
        - GRC
        - GRL
        - GRD
        - GLP
        - GUM
        - GTM
        - GGY
        - GIN
        - GNB
        - GUY
        - HTI
        - HMD
        - VAT
        - HND
        - HKG
        - HUN
        - ISL
        - IND
        - IDN
        - IRN
        - IRQ
        - IRL
        - IMN
        - ISR
        - ITA
        - JAM
        - JPN
        - JEY
        - JOR
        - KAZ
        - KEN
        - KIR
        - PRK
        - KOR
        - KWT
        - KGZ
        - LAO
        - LVA
        - LBN
        - LSO
        - LBR
        - LBY
        - LIE
        - LTU
        - LUX
        - MAC
        - MDG
        - MWI
        - MYS
        - MDV
        - MLI
        - MLT
        - MHL
        - MTQ
        - MRT
        - MUS
        - MYT
        - MEX
        - FSM
        - MDA
        - MCO
        - MNG
        - MNE
        - MSR
        - MAR
        - MOZ
        - MMR
        - NAM
        - NRU
        - NPL
        - NLD
        - NCL
        - NZL
        - NIC
        - NER
        - NGA
        - NIU
        - NFK
        - MKD
        - MNP
        - NOR
        - OMN
        - PAK
        - PLW
        - PSE
        - PAN
        - PNG
        - PRY
        - PER
        - PHL
        - PCN
        - POL
        - PRT
        - PRI
        - QAT
        - REU
        - ROU
        - RUS
        - RWA
        - BLM
        - SHN
        - KNA
        - LCA
        - MAF
        - SPM
        - VCT
        - WSM
        - SMR
        - STP
        - SAU
        - SEN
        - SRB
        - SYC
        - SLE
        - SGP
        - SXM
        - SVK
        - SVN
        - SLB
        - SOM
        - ZAF
        - SGS
        - SSD
        - ESP
        - LKA
        - SDN
        - SUR
        - SJM
        - SWE
        - CHE
        - SYR
        - TWN
        - TJK
        - TZA
        - THA
        - TLS
        - TGO
        - TKL
        - TON
        - TTO
        - TUN
        - TUR
        - TKM
        - TCA
        - TUV
        - UGA
        - UKR
        - ARE
        - GBR
        - USA
        - UMI
        - URY
        - UZB
        - VUT
        - VEN
        - VNM
        - VGB
        - VIR
        - WLF
        - ESH
        - YEM
        - ZMB
        - ZWE
    CoverType:
      description: Level of cover of product
      title: Cover Type
      x-stoplight:
        id: ulu9272rswvsl
      type: string
      enum:
        - ANNUAL
        - MONTHLY
    PartnerQuoteReference_2:
      title: Partner Quote Reference
      x-stoplight:
        id: 3biyub0pv4wsc
      type: string
      description: Partner Quote Reference number generated by the CTM Partners as part of the Journey
      example: PQ-01231AS
    Postcode:
      title: Postcode
      x-stoplight:
        id: coa6e96t5n53t
      x-tags:
        - Field
      type: string
      description: Australian Postcodes
      pattern: '^(?:(?:[2-8]\d|9[0-7]|0?[28]|0?9(?=09))(?:\d{2}))$'
      example: '4066'
    QuoteReference_2:
      title: Quote Reference
      x-stoplight:
        id: w9yf6s5py0qf5
      type: string
      description: Quote Reference generated by CTM for a Customer User Journey
      example: Q-CTM-PET-00012
